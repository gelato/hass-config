title: Summary
path: summary
id: summary

type: custom:grid-layout
layout: !include snippets/layout-4-column.yaml

cards:
  # Header
  - type: markdown
    view_layout:
      grid-column: 1/-1
    card_mod:
      style: !include snippets/style-markdown-titles.yaml
    content: >
      {%- set batterySensors = states.sensor | selectattr('attributes.device_class', 'defined') | selectattr('attributes.device_class', 'equalto', 'battery') | rejectattr('state', 'in', ['unavailable', 'unknown', 'None']) | list -%}
      {%- set lowBatterySensors = batterySensors | map(attribute='state') | map('float') | select('>=', 0) | select('<=', 30) | map('string') | list -%}

      {%- set batteryBinarySensors = states.binary_sensor | selectattr('attributes.device_class', 'defined') | selectattr('attributes.device_class', 'equalto', 'battery') | rejectattr('state', 'in', ['unavailable', 'unknown', 'None']) | list -%}
      {%- set lowBatteryBinarySensors = batteryBinarySensors | selectattr('state', 'equalto', 'on') | list -%}

      {%- set lowBatteryDevicesCount = (lowBatterySensors | count) + (lowBatteryBinarySensors | count) -%}
      # Good {{ states.sensor.system_time_of_day.state }}, {{ user }}.

      {% if lowBatteryDevicesCount > 0 -%}
      ðŸš¨ ÐÐ° Ð´Ð°Ð½Ð½Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ {{ iif((lowBatteryDevicesCount == 1), 'Ð¾Ð´Ð½Ð¾', 'Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾') }} {{ iif((lowBatteryDevicesCount == 1), 'ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾', 'ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²') }} - {{ lowBatteryDevicesCount }} {{ iif((lowBatteryDevicesCount == 1), 'ÑÐ¾Ð¾Ð±Ñ‰Ð°ÐµÑ‚', 'ÑÐ¾Ð¾Ð±Ñ‰Ð°ÑŽÑ‚') }} Ð¾ Ð½Ð¸Ð·ÐºÐ¾Ð¼ Ð·Ð°Ñ€ÑÐ´Ðµ. ÐÐ°Ð´Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ [Ð£ÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°](/lovelace/devices?anchor=devices_low_battery) Ð´Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐµÐ¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸! ðŸš¨
      {%- endif %}

  # Security / Modes
  - type: vertical-stack
    cards:
      - type: heading
        heading_style: subtitle
        heading: Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

      - type: grid
        columns: 3
        square: true
        cards:
          - type: "custom:mushroom-template-card"
            entity: alarm_control_panel.house
            layout: vertical
            icon: >
              {{ state_attr(entity, "icon") }}
            icon_color: >
              {% if is_state(entity, 'disarmed') %}
                var(--rgb-success-color)
              {% elif is_state(entity, 'arming') %}
                var(--rgb-warning-color)
              {% elif is_state(entity, ['armed_away', 'armed_night', 'armed_home']) %}
                var(--rgb-error-color)
              {% endif %}
            primary: Alarm
            secondary: >
              {{ states(entity) | capitalize }}
            fill_container: true
            tap_action: !include popups/alarm.yaml
            # tap_action:
            #   action: more-info

          - type: "custom:mushroom-person-card"
            name: Ð¤Ð¸Ð»Ð¸Ð¿Ð¿
            entity: sensor.holder_geocoded_location
            layout: vertical
            fill_container: true
            use_entity_picture: true

          - type: "custom:mushroom-person-card"
            entity: person.van_holder_2
            layout: vertical
            fill_container: true
            use_entity_picture: true

      - type: heading
        heading_style: subtitle
        heading: Ð ÐµÐ¶Ð¸Ð¼Ñ‹

      - type: grid
        columns: 3
        square: true
        cards:
          - type: custom:mushroom-entity-card
            entity: input_boolean.home_modes_away_mode
            name: ÐÐµ Ð´Ð¾Ð¼Ð°
            icon: mdi:home
            layout: vertical
            secondary_info: state
            fill_container: true
            tap_action:
              action: toggle
              confirmation:
                text: Ð¢Ð¾Ñ‡Ð½Ð¾ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ€ÐµÐ¶Ð¸Ð¼ "ÐÐµ Ð´Ð¾Ð¼Ð°"?

          - type: custom:mushroom-entity-card
            entity: input_boolean.home_modes_guest_mode
            name: Ð“Ð¾ÑÑ‚ÐµÐ²Ð¾Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼
            icon: mdi:human-handsup
            layout: vertical
            secondary_info: state
            fill_container: true
            tap_action:
              action: toggle
              confirmation:
                text: Ð¢Ð¾Ñ‡Ð½Ð¾ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð³Ð¾ÑÑ‚ÐµÐ²Ð¾Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼?

          - type: custom:mushroom-entity-card
            entity: input_boolean.home_modes_bedtime_mode
            name: ÐŸÐ¾Ñ€Ð° ÑÐ¿Ð°Ñ‚ÑŒ
            icon: mdi:sleep
            layout: vertical
            secondary_info: state
            fill_container: true
            tap_action:
              action: toggle
              confirmation:
                text: Ð¢Ð¾Ñ‡Ð½Ð¾ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¾Ñ‚Ñ…Ð¾Ð´Ð° ÐºÐ¾ ÑÐ½Ñƒ?

          - type: custom:mushroom-entity-card
            entity: input_boolean.home_modes_vacation_mode
            name: ÐžÑ‚Ð¿ÑƒÑÐº
            icon: mdi:airplane
            layout: vertical
            secondary_info: state
            fill_container: true
            tap_action:
              action: toggle
              confirmation:
                text: Ð¢Ð¾Ñ‡Ð½Ð¾ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¾Ñ‚Ð¿ÑƒÑÐºÐ°?

  # Climate / Energy
  - type: vertical-stack
    cards:
      - type: heading
        heading_style: subtitle
        heading: ÐšÐ»Ð¸Ð¼Ð°Ñ‚

      - type: custom:mushroom-climate-card
        name: Ð¢ÐµÑ€Ð¼Ð¾ÑÑ‚Ð°Ñ‚ Ð² Ð³Ð¾ÑÑ‚Ð¸Ð½Ð¾Ð¹
        entity: climate.living_room
        hvac_modes: []
        # show_temperature_control: true
        fill_container: true

      - type: custom:mushroom-fan-card
        name: Ð¦ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð²ÐµÐ½Ñ‚Ð¸Ð»ÑÑ†Ð¸Ñ
        entity: fan.attic_ventilation_esp_fan
        # show_percentage_control: true
        icon_animation: true
        fill_container: true
        tap_action:
          action: more-info

      - type: heading
        heading_style: subtitle
        heading: Ð­Ð½ÐµÑ€Ð³Ð¸Ñ

      - type: custom:power-flow-card-plus
        entities:
          battery:
            entity: ''
          grid:
            entity:
              consumption: sensor.downstairs_hallway_water_p1_meter_power_consumed_w
              production: sensor.downstairs_hallway_water_p1_meter_power_produced_w
          solar:
            entity: sensor.garage_solaredge_inverter_dc_power
            display_zero_state: true
          home:
            # entity: sensor.electricity_currently_used
            entity: ''
          individual:
            - color_icon: true
              color_value: 'true'
              inverted_animation: true
              display_zero: true
              display_zero_state: true
              entity: sensor.downstairs_hallway_water_p1_meter_gas_consumed
              icon: mdi:fire
              color:
                - 97
                - 23
                - 124
              name: Gas
              unit_of_measurement: mÂ³
              show_direction: false
              use_metadata: false
              unit_white_space: true
        clickable_entities: false
        display_zero_lines: true
        use_new_flow_rate_model: true
        w_decimals: 0
        kw_decimals: 1
        min_flow_rate: 0.75
        max_flow_rate: 6
        max_expected_power: 2000
        min_expected_power: 0.01
        watt_threshold: 1000
        transparency_zero_lines: 0
        dashboard_link: /energy

  # Trash
  - type: vertical-stack
    cards:
      - type: heading
        heading_style: subtitle
        heading: ÐœÑƒÑÐ¾Ñ€

      - type: grid
        columns: 2
        square: false
        cards:
          - type: custom:mushroom-template-card
            entity: sensor.afvalinfo_home_restafval
            layout: vertical
            primary: Restafval
            secondary: >
              {{ states(entity) }}
            tap_action: none
            icon: >
              {{ state_attr(entity, 'icon') }}
            icon_color: >
              {% if state_attr(entity, 'days_until_collection_date') == 0 %}
                ); --icon-color: var(--error-color);
              {% elif state_attr(entity, 'days_until_collection_date') == 1 %}
                ); --icon-color: var(--warning-color);
              {% else %}
                var(--disabled-color)
              {% endif %} --shape-color: rgb(from var(--icon-color) r g b / 0.2);

          - type: custom:mushroom-template-card
            entity: sensor.afvalinfo_home_gft
            layout: vertical
            primary: GFT
            secondary: >
              {{ states(entity) }}
            tap_action: none
            icon: >
              {{ state_attr(entity, 'icon') }}
            icon_color: >
              {% if state_attr(entity, 'days_until_collection_date') == 0 %}
                ); --icon-color: var(--error-color);
              {% elif state_attr(entity, 'days_until_collection_date') == 1 %}
                ); --icon-color: var(--warning-color);
              {% else %}
                var(--disabled-color)
              {% endif %} --shape-color: rgb(from var(--icon-color) r g b / 0.2);

          - type: custom:mushroom-template-card
            entity: sensor.afvalinfo_home_pbd
            layout: vertical
            primary: PMD
            secondary: >
              {{ states(entity) }}
            tap_action: none
            icon: >
              {{ state_attr(entity, 'icon') }}
            icon_color: >
              {% if state_attr(entity, 'days_until_collection_date') == 0 %}
                ); --icon-color: var(--error-color);
              {% elif state_attr(entity, 'days_until_collection_date') == 1 %}
                ); --icon-color: var(--warning-color);
              {% else %}
                var(--disabled-color)
              {% endif %} --shape-color: rgb(from var(--icon-color) r g b / 0.2);

          - type: custom:mushroom-template-card
            entity: sensor.afvalinfo_home_papier
            layout: vertical
            primary: Papier
            secondary: >
              {{ states(entity) }}
            tap_action: none
            icon: >
              {{ state_attr(entity, 'icon') }}
            icon_color: >
              {% if state_attr(entity, 'days_until_collection_date') == 0 %}
                ); --icon-color: var(--error-color);
              {% elif state_attr(entity, 'days_until_collection_date') == 1 %}
                ); --icon-color: var(--warning-color);
              {% else %}
                var(--disabled-color)
              {% endif %} --shape-color: rgb(from var(--icon-color) r g b / 0.2);

      - type: heading
        heading_style: subtitle
        heading: Ð£ÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°

      - type: grid
        columns: 3
        square: true
        cards:
          - type: custom:mushroom-template-card
            entity: vacuum.valetudo_livingroom
            layout: vertical
            fill_container: true
            primary: >
              {{ state_attr(entity, 'friendly_name') }}
            secondary: >
              {{ states(entity) | capitalize }}
            icon: mdi:robot-vacuum
            icon_color: >
              {% if is_state(entity, 'cleaning') %}
                var(--rgb-warning-color)
              {% endif %}
