title: Обзор
path: summary
id: summary

type: custom:grid-layout
layout: !include snippets/layout-4-column.yaml

cards:
  # Header
  - type: custom:button-card
    view_layout:
        grid-column: 1/-1
    name: Обзор
    styles:
      card:
        - font-family: Roboto
        - background: none
        - padding: 16px 0
        - '--mdc-ripple-press-opacity': 0
      name:
        - font-size: 32px
        - color: var(--contrast20)

  # Scenes/Lights
  - type: vertical-stack
    cards:
      - type: heading
        heading_style: subtitle
        heading: Сцены

      - type: grid
        columns: 4
        square: false
        cards:
          - type: custom:button-card
            icon: mdi:weather-night
            aspect_ratio: 1/1
            tap_action:
              action: call-service
              service: scene.turn_on
              haptic: medium
              service_data:
                entity_id: scene.home_lights_off
            styles:
              card:
                - border-radius: 24px
                - background-color: var(--blue)
              icon:
                - color: var(--black)

          - type: "custom:mushroom-person-card"
            name: Филипп
            entity: sensor.holder_geocoded_location
            layout: vertical
            fill_container: true
            use_entity_picture: true

          - type: "custom:mushroom-person-card"
            entity: sensor.nesyk_geocoded_location
            layout: vertical
            fill_container: true
            use_entity_picture: true

      - type: heading
        heading_style: subtitle
        heading: Освещение

      - type: grid
        columns: 2
        square: false
        cards:
          - type: custom:button-card
            name: Свет в гостиной
            icon: mdi:track-light
            entity: light.guestroom_ceiling_light
            tap_action:
              action: toggle
              haptic: medium
            hold_action:
              action: more-info
              haptic: medium
            custom_fields:
              slider:
                card:
                  type: custom:my-slider-v2
                  entity: light.guestroom_ceiling_light
                  colorMode: brightness
                  styles:
                    container:
                      - background: none
                      - border-radius: 100px
                      - overflow: visible
                    card:
                      - height: 16px
                      - padding: 0 8px
                      - background: |
                          [[[
                            if (entity.state == "on") return "linear-gradient(90deg, rgba(255,255,255, 0.3) 0%, rgba(255,255,255, 1) 100%)";
                            else return "var(--contrast4)";
                          ]]]
                    track:
                      - overflow: visible
                      - background: none
                    progress:
                      - background: none
                    thumb:
                      - background: |
                          [[[
                            if (entity.state == "on") return "var(--black)";
                            if (entity.state == "off") return "var(--contrast20)";
                            else return "var(--contrast8)";
                          ]]]
                      - top: 2px
                      - right: '-6px'
                      - height: 12px
                      - width: 12px
                      - border-radius: 100px
            styles:
              grid:
                - grid-template-areas: '"i" "n" "slider"'
                - grid-template-columns: 1fr
                - grid-template-rows: 1fr min-content min-content
              card:
                - font-family: Roboto
                - background: var(--contrast2)
                - padding: 16px
                - '--mdc-ripple-press-opacity': 0
              img_cell:
                - justify-self: start
                - width: 24px
              icon:
                - width: 24px
                - height: 24px
                - color: var(--contrast8)
              name:
                - justify-self: start
                - font-size: 14px
                - margin: 4px 0 12px 0
                - color: var(--contrast8)
            state:
              - value: 'on'
                styles:
                  card:
                    - background: var(--yellow)
                  icon:
                    - color: var(--black)
                  name:
                    - color: var(--black)
              - value: 'off'
                styles:
                  icon:
                    - color: var(--contrast20)
                  name:
                    - color: var(--contrast20)

          - type: custom:button-card
            name: Боковой свет в гостиной
            icon: '[[[ return entity.attributes.icon ]]]'
            entity: light.guestroom_ceiling_sidelight
            tap_action:
              action: toggle
              haptic: medium
            hold_action:
              action: more-info
              haptic: medium
            custom_fields:
              slider:
                card:
                  type: custom:my-slider-v2
                  entity: "[[[ return entity.entity_id ]]]"
                  colorMode: brightness
                  styles:
                    container:
                      - background: none
                      - border-radius: 100px
                      - overflow: visible
                    card:
                      - height: 16px
                      - padding: 0 8px
                      - background: |
                          [[[
                            if (entity.state == "on") return "linear-gradient(90deg, rgba(255,255,255, 0.3) 0%, rgba(255,255,255, 1) 100%)";
                            else return "var(--contrast4)";
                          ]]]
                    track:
                      - overflow: visible
                      - background: none
                    progress:
                      - background: none
                    thumb:
                      - background: |
                          [[[
                            if (entity.state == "on") return "var(--black)";
                            if (entity.state == "off") return "var(--contrast20)";
                            else return "var(--contrast8)";
                          ]]]
                      - top: 2px
                      - right: '-8px'
                      - height: 12px
                      - width: 12px
                      - border-radius: 10px
            styles:
              grid:
                - grid-template-areas: '"i" "n" "slider"'
                - grid-template-columns: 1fr
                - grid-template-rows: 1fr min-content min-content
              card:
                - font-family: Roboto
                - background: var(--contrast2)
                - padding: 16px
                - '--mdc-ripple-press-opacity': 0
              img_cell:
                - justify-self: start
                - width: 24px
              icon:
                - width: 24px
                - height: 24px
                - color: var(--contrast8)
              name:
                - justify-self: start
                - font-size: 14px
                - margin: 4px 0 12px 0
                - color: var(--contrast8)
            state:
              - value: 'on'
                styles:
                  card:
                    - background: |
                          [[[
                              var color = entity.attributes?.rgb_color;
                              if (entity.state != "on"){
                                return 'var(--contrast20)';
                              }
                              else if (color){
                                return 'rgba(' + color + ')'
                              }
                              else{
                                return 'var(--yellow)'
                              }
                          ]]]
                  icon:
                    - color: var(--black)
                  name:
                    - color: var(--black)
              - value: 'off'
                styles:
                  icon:
                    - color: var(--contrast20)
                  name:
                    - color: var(--contrast20)
      
          - type: custom:button-card
            name: Свет в столовой
            icon: mdi:track-light
            entity: light.dining_room_light
            tap_action:
              action: toggle
              haptic: medium
            hold_action:
              action: more-info
              haptic: medium
            custom_fields:
              slider:
                card:
                  type: custom:my-slider-v2
                  entity: light.dining_room_light
                  colorMode: brightness
                  styles:
                    container:
                      - background: none
                      - border-radius: 100px
                      - overflow: visible
                    card:
                      - height: 16px
                      - padding: 0 8px
                      - background: |
                          [[[
                            if (entity.state == "on") return "linear-gradient(90deg, rgba(255,255,255, 0.3) 0%, rgba(255,255,255, 1) 100%)";
                            else return "var(--contrast4)";
                          ]]]
                    track:
                      - overflow: visible
                      - background: none
                    progress:
                      - background: none
                    thumb:
                      - background: |
                          [[[
                            if (entity.state == "on") return "var(--black)";
                            if (entity.state == "off") return "var(--contrast20)";
                            else return "var(--contrast8)";
                          ]]]
                      - top: 2px
                      - right: '-6px'
                      - height: 12px
                      - width: 12px
                      - border-radius: 100px
            styles:
              grid:
                - grid-template-areas: '"i" "n" "slider"'
                - grid-template-columns: 1fr
                - grid-template-rows: 1fr min-content min-content
              card:
                - font-family: Roboto
                - background: var(--contrast2)
                - padding: 16px
                - '--mdc-ripple-press-opacity': 0
              img_cell:
                - justify-self: start
                - width: 24px
              icon:
                - width: 24px
                - height: 24px
                - color: var(--contrast8)
              name:
                - justify-self: start
                - font-size: 14px
                - margin: 4px 0 12px 0
                - color: var(--contrast8)
            state:
              - value: 'on'
                styles:
                  card:
                    - background: var(--yellow)
                  icon:
                    - color: var(--black)
                  name:
                    - color: var(--black)
              - value: 'off'
                styles:
                  icon:
                    - color: var(--contrast20)
                  name:
                    - color: var(--contrast20)

          - type: custom:button-card
            name: Ночник в столовой
            icon: mdi:track-light
            entity: light.dining_room_light_nightlight
            tap_action:
              action: toggle
              haptic: medium
            hold_action:
              action: more-info
              haptic: medium
            custom_fields:
              slider:
                card:
                  type: custom:my-slider-v2
                  entity: light.dining_room_light_nightlight
                  colorMode: brightness
                  styles:
                    container:
                      - background: none
                      - border-radius: 100px
                      - overflow: visible
                    card:
                      - height: 16px
                      - padding: 0 8px
                      - background: |
                          [[[
                            if (entity.state == "on") return "linear-gradient(90deg, rgba(255,255,255, 0.3) 0%, rgba(255,255,255, 1) 100%)";
                            else return "var(--contrast4)";
                          ]]]
                    track:
                      - overflow: visible
                      - background: none
                    progress:
                      - background: none
                    thumb:
                      - background: |
                          [[[
                            if (entity.state == "on") return "var(--black)";
                            if (entity.state == "off") return "var(--contrast20)";
                            else return "var(--contrast8)";
                          ]]]
                      - top: 2px
                      - right: '-6px'
                      - height: 12px
                      - width: 12px
                      - border-radius: 100px
            styles:
              grid:
                - grid-template-areas: '"i" "n" "slider"'
                - grid-template-columns: 1fr
                - grid-template-rows: 1fr min-content min-content
              card:
                - font-family: Roboto
                - background: var(--contrast2)
                - padding: 16px
                - '--mdc-ripple-press-opacity': 0
              img_cell:
                - justify-self: start
                - width: 24px
              icon:
                - width: 24px
                - height: 24px
                - color: var(--contrast8)
              name:
                - justify-self: start
                - font-size: 14px
                - margin: 4px 0 12px 0
                - color: var(--contrast8)
            state:
              - value: 'on'
                styles:
                  card:
                    - background: var(--yellow)
                  icon:
                    - color: var(--black)
                  name:
                    - color: var(--black)
              - value: 'off'
                styles:
                  icon:
                    - color: var(--contrast20)
                  name:
                    - color: var(--contrast20)

          - type: custom:button-card
            name: Свет в спальне
            icon: mdi:track-light
            entity: light.bedroom_ceiling_light
            tap_action:
              action: toggle
              haptic: medium
            hold_action:
              action: more-info
              haptic: medium
            custom_fields:
              slider:
                card:
                  type: custom:my-slider-v2
                  entity: light.bedroom_ceiling_light
                  colorMode: brightness
                  styles:
                    container:
                      - background: none
                      - border-radius: 100px
                      - overflow: visible
                    card:
                      - height: 16px
                      - padding: 0 8px
                      - background: |
                          [[[
                            if (entity.state == "on") return "linear-gradient(90deg, rgba(255,255,255, 0.3) 0%, rgba(255,255,255, 1) 100%)";
                            else return "var(--contrast4)";
                          ]]]
                    track:
                      - overflow: visible
                      - background: none
                    progress:
                      - background: none
                    thumb:
                      - background: |
                          [[[
                            if (entity.state == "on") return "var(--black)";
                            if (entity.state == "off") return "var(--contrast20)";
                            else return "var(--contrast8)";
                          ]]]
                      - top: 2px
                      - right: '-6px'
                      - height: 12px
                      - width: 12px
                      - border-radius: 100px
            styles:
              grid:
                - grid-template-areas: '"i" "n" "slider"'
                - grid-template-columns: 1fr
                - grid-template-rows: 1fr min-content min-content
              card:
                - font-family: Roboto
                - background: var(--contrast2)
                - padding: 16px
                - '--mdc-ripple-press-opacity': 0
              img_cell:
                - justify-self: start
                - width: 24px
              icon:
                - width: 24px
                - height: 24px
                - color: var(--contrast8)
              name:
                - justify-self: start
                - font-size: 14px
                - margin: 4px 0 12px 0
                - color: var(--contrast8)
            state:
              - value: 'on'
                styles:
                  card:
                    - background: var(--yellow)
                  icon:
                    - color: var(--black)
                  name:
                    - color: var(--black)
              - value: 'off'
                styles:
                  icon:
                    - color: var(--contrast20)
                  name:
                    - color: var(--contrast20)

          - type: custom:button-card
            name: Ночник в спальне
            icon: mdi:track-light
            entity: light.bedroom_ceiling_nightlight
            tap_action:
              action: toggle
              haptic: medium
            hold_action:
              action: more-info
              haptic: medium
            custom_fields:
              slider:
                card:
                  type: custom:my-slider-v2
                  entity: light.bedroom_ceiling_nightlight
                  colorMode: brightness
                  styles:
                    container:
                      - background: none
                      - border-radius: 100px
                      - overflow: visible
                    card:
                      - height: 16px
                      - padding: 0 8px
                      - background: |
                          [[[
                            if (entity.state == "on") return "linear-gradient(90deg, rgba(255,255,255, 0.3) 0%, rgba(255,255,255, 1) 100%)";
                            else return "var(--contrast4)";
                          ]]]
                    track:
                      - overflow: visible
                      - background: none
                    progress:
                      - background: none
                    thumb:
                      - background: |
                          [[[
                            if (entity.state == "on") return "var(--black)";
                            if (entity.state == "off") return "var(--contrast20)";
                            else return "var(--contrast8)";
                          ]]]
                      - top: 2px
                      - right: '-6px'
                      - height: 12px
                      - width: 12px
                      - border-radius: 100px
            styles:
              grid:
                - grid-template-areas: '"i" "n" "slider"'
                - grid-template-columns: 1fr
                - grid-template-rows: 1fr min-content min-content
              card:
                - font-family: Roboto
                - background: var(--contrast2)
                - padding: 16px
                - '--mdc-ripple-press-opacity': 0
              img_cell:
                - justify-self: start
                - width: 24px
              icon:
                - width: 24px
                - height: 24px
                - color: var(--contrast8)
              name:
                - justify-self: start
                - font-size: 14px
                - margin: 4px 0 12px 0
                - color: var(--contrast8)
            state:
              - value: 'on'
                styles:
                  card:
                    - background: var(--yellow)
                  icon:
                    - color: var(--black)
                  name:
                    - color: var(--black)
              - value: 'off'
                styles:
                  icon:
                    - color: var(--contrast20)
                  name:
                    - color: var(--contrast20)

          - type: custom:button-card
            name: Свет на кухне
            icon: mdi:track-light
            entity: light.kukhnia_potolochnyi_svet
            tap_action:
              action: toggle
              haptic: medium
            hold_action:
              action: more-info
              haptic: medium
            custom_fields:
              slider:
                card:
                  type: custom:my-slider-v2
                  entity: light.kukhnia_potolochnyi_svet
                  colorMode: brightness
                  styles:
                    container:
                      - background: none
                      - border-radius: 100px
                      - overflow: visible
                    card:
                      - height: 16px
                      - padding: 0 8px
                      - background: |
                          [[[
                            if (entity.state == "on") return "linear-gradient(90deg, rgba(255,255,255, 0.3) 0%, rgba(255,255,255, 1) 100%)";
                            else return "var(--contrast4)";
                          ]]]
                    track:
                      - overflow: visible
                      - background: none
                    progress:
                      - background: none
                    thumb:
                      - background: |
                          [[[
                            if (entity.state == "on") return "var(--black)";
                            if (entity.state == "off") return "var(--contrast20)";
                            else return "var(--contrast8)";
                          ]]]
                      - top: 2px
                      - right: '-6px'
                      - height: 12px
                      - width: 12px
                      - border-radius: 100px
            styles:
              grid:
                - grid-template-areas: '"i" "n" "slider"'
                - grid-template-columns: 1fr
                - grid-template-rows: 1fr min-content min-content
              card:
                - font-family: Roboto
                - background: var(--contrast2)
                - padding: 16px
                - '--mdc-ripple-press-opacity': 0
              img_cell:
                - justify-self: start
                - width: 24px
              icon:
                - width: 24px
                - height: 24px
                - color: var(--contrast8)
              name:
                - justify-self: start
                - font-size: 14px
                - margin: 4px 0 12px 0
                - color: var(--contrast8)
            state:
              - value: 'on'
                styles:
                  card:
                    - background: var(--yellow)
                  icon:
                    - color: var(--black)
                  name:
                    - color: var(--black)
              - value: 'off'
                styles:
                  icon:
                    - color: var(--contrast20)
                  name:
                    - color: var(--contrast20)

          - type: custom:button-card
            name: Лампа Влада
            icon: mdi:track-light
            entity: light.guestroom_desk_lamp
            tap_action:
              action: toggle
              haptic: medium
            hold_action:
              action: more-info
              haptic: medium
            custom_fields:
              slider:
                card:
                  type: custom:my-slider-v2
                  entity: light.guestroom_desk_lamp
                  colorMode: brightness
                  styles:
                    container:
                      - background: none
                      - border-radius: 100px
                      - overflow: visible
                    card:
                      - height: 16px
                      - padding: 0 8px
                      - background: |
                          [[[
                            if (entity.state == "on") return "linear-gradient(90deg, rgba(255,255,255, 0.3) 0%, rgba(255,255,255, 1) 100%)";
                            else return "var(--contrast4)";
                          ]]]
                    track:
                      - overflow: visible
                      - background: none
                    progress:
                      - background: none
                    thumb:
                      - background: |
                          [[[
                            if (entity.state == "on") return "var(--black)";
                            if (entity.state == "off") return "var(--contrast20)";
                            else return "var(--contrast8)";
                          ]]]
                      - top: 2px
                      - right: '-6px'
                      - height: 12px
                      - width: 12px
                      - border-radius: 100px
            styles:
              grid:
                - grid-template-areas: '"i" "n" "slider"'
                - grid-template-columns: 1fr
                - grid-template-rows: 1fr min-content min-content
              card:
                - font-family: Roboto
                - background: var(--contrast2)
                - padding: 16px
                - '--mdc-ripple-press-opacity': 0
              img_cell:
                - justify-self: start
                - width: 24px
              icon:
                - width: 24px
                - height: 24px
                - color: var(--contrast8)
              name:
                - justify-self: start
                - font-size: 14px
                - margin: 4px 0 12px 0
                - color: var(--contrast8)
            state:
              - value: 'on'
                styles:
                  card:
                    - background: var(--yellow)
                  icon:
                    - color: var(--black)
                  name:
                    - color: var(--black)
              - value: 'off'
                styles:
                  icon:
                    - color: var(--contrast20)
                  name:
                    - color: var(--contrast20)

  # Climate / Energy
  - type: vertical-stack
    cards:
      - type: heading
        heading_style: subtitle
        heading: Климат

      - type: grid
        columns: 3
        square: false
        cards:
          - type: sensor
            entity: sensor.bedroom_temperature
            hours_to_show: 24
            detail: 1
            graph: line
            name: Спальня
            icon: none
            card_mod:
              class: graph
          - type: sensor
            entity: sensor.dining_temperature
            hours_to_show: 24
            detail: 1
            graph: line
            name: Столовая
            icon: none
            card_mod:
              class: graph
          - type: sensor
            entity: sensor.guestroom_temperature
            hours_to_show: 24
            detail: 1
            graph: line
            name: Гостиная
            icon: none
            card_mod:
              class: graph

      - type: grid
        columns: 3
        square: false
        cards:
          - type: sensor
            entity: sensor.bedroom_humidity
            hours_to_show: 24
            detail: 1
            graph: line
            name: Спальня
            icon: none
            card_mod:
              class: graph
          - type: sensor
            entity: sensor.dining_humidity
            hours_to_show: 24
            detail: 1
            graph: line
            name: Столовая
            icon: none
            card_mod:
              class: graph
          - type: sensor
            entity: sensor.guestroom_humidity
            hours_to_show: 24
            detail: 1
            graph: line
            name: Гостиная
            icon: none
            card_mod:
              class: graph
          # - type: sensor
          #   entity: sensor.street_humidity
          #   hours_to_show: 24
          #   detail: 1
          #   graph: line
          #   name: Улица
          #   icon: none
          #   card_mod:
          #     class: graph

      - type: custom:mushroom-climate-card
        name: Кондиционер в спальне
        entity: climate.bedroom_ac
        hvac_modes:
          - cool
          - auto
          - heat
          - dry
          - "off"
        show_temperature_control: true
        fill_container: true

      - type: custom:mushroom-fan-card
        name: Вентилятор в столовой
        entity: fan.dmaker_p45_cfbf_fan
        show_percentage_control: true
        icon_animation: true
        fill_container: true
        tap_action:
          action: more-info

      - type: custom:mushroom-humidifier-card
        name: Увлажнитель в спальне
        entity: humidifier.xiaomi_p1200_e977_humidifier
        show_percentage_control: true
        icon_animation: true
        fill_container: true
        primary_info: name
        secondary_info: state
        show_target_humidity_control: true
        collapsible_controls: true
        tap_action:
          action: more-info

      # - type: custom:mushroom-humidifier-card
      #   name: Увлажнитель в гостиной
      #   entity: humidifier.living_room_humidifier
      #   primary_info: name
      #   secondary_info: state
      #   icon_animation: true
      #   fill_container: true
      #   icon_type: icon
      #   show_target_humidity_control: true
      #   collapsible_controls: true
      #   tap_action:
      #     action: more-info

      - type: heading
        heading_style: subtitle
        heading: Энергия

      - type: custom:power-flow-card-plus
        entities:
          grid:
            entity:
              consumption: sensor.tz3000_qeuvnohg_ts011f_summation_delivered
              production: sensor.downstairs_hallway_water_p1_meter_power_produced_w
          home:
            # entity: sensor.electricity_currently_used
            entity: ""
          individual:
            - color_icon: true
              color_value: "true"
              inverted_animation: true
              display_zero: true
              display_zero_state: true
              entity: sensor.downstairs_hallway_water_p1_meter_gas_consumed
              icon: mdi:fire
              color:
                - 97
                - 23
                - 124
              name: Gas
              unit_of_measurement: m³
              show_direction: false
              use_metadata: false
              unit_white_space: true
        clickable_entities: false
        display_zero_lines: true
        use_new_flow_rate_model: true
        w_decimals: 0
        kw_decimals: 1
        min_flow_rate: 0.75
        max_flow_rate: 6
        max_expected_power: 2000
        min_expected_power: 0.01
        watt_threshold: 1000
        transparency_zero_lines: 0
        dashboard_link: /energy

  # Lights
  - type: vertical-stack
    cards:
      - type: heading
        heading_style: subtitle
        heading: Погода на улице

      - type: grid
        columns: 2
        square: false
        cards:
          - type: "custom:decluttering-card"
            template: multi_graph_card
            variables:
              - title: Температура на улице
              - entities:
                  - entity: sensor.street_temperature
                    # attribute: temperature
                    unit: °C
                    name: Снаружи
              - line_width: 1
          
          - type: "custom:decluttering-card"
            template: multi_graph_card
            variables:
              - title: Влажность на улице
              - entities:
                  - entity: sensor.street_humidity
                    # attribute: temperature
                    unit: "%"
                    name: Снаружи
              - line_width: 1

      - type: heading
        heading_style: subtitle
        heading: Камеры на улице

      - type: custom:webrtc-camera
        url: gates_hq
        mode:
          - webrtc
          - mse
        name: Ворота
        media: video,audio
        muted: true
        style: '.mode {display: none}'

      - type: custom:webrtc-camera
        url: door_hq
        mode:
          - webrtc
          - mse
        name: Двор
        media: video,audio
        muted: true
        style: '.mode {display: none}'

      - type: custom:webrtc-camera
        url: dvor_gates_hq
        mode:
          - webrtc
          - mse
        name: Двор, вид на ворота
        media: video,audio
        muted: true
        style: '.mode {display: none}'

      - type: custom:webrtc-camera
        url: dom2_hq
        mode:
          - webrtc
          - mse
        name: Двор, вид второй дом
        media: video,audio
        muted: true
        style: '.mode {display: none}'

      - type: custom:webrtc-camera
        url: street_hq
        mode:
          - mse
        name: Улица за окнами
        media: video,audio
        muted: true
        style: '.mode {display: none}'